# 要求仕様書

以下は、発注会社とベンダーが共有して利用する課題管理用デスクトップアプリケーションの要求仕様書である。要求は機能的要求と技術的要求に分け、各要求に要求IDを付与する。

## 1. システム概要と前提

本システムは、発注会社とベンダーの間で共有される一つのプロジェクトに関する課題を管理するためのデスクトップアプリケーションとし、現状の「一プロジェクト一エクセルファイル、シートごとにカテゴリを分割する」運用を代替しつつ、特に課題ごとのコメントのやり取りをログとして分かりやすく残すことを主な目的とする（FR-001）。

本システムは一度の起動につき一つのプロジェクトのみを対象とし、対象プロジェクトのデータフォルダは起動時に設定ファイルまたは起動時の選択画面で指定される。選択画面で指定された場合、そのパスは設定ファイルに保存され次回起動時の既定値として利用される。起動後の画面上でのプロジェクト切り替え機能は提供しない（FR-002）。発注会社とベンダーの双方が、本システムを用いて同じプロジェクトの課題を参照・更新するが、発注会社がマスタとして課題のクローズおよび却下の権限を持つ前提とする（FR-003）。

本システムは、個々のユーザを識別・管理するユーザ管理機能やユーザ単位の認証機構を持たず、アプリケーションは起動時に所定パスに配置された発注会社専用設定ファイルの有無およびその内容により会社モードを判定する。発注会社専用設定ファイルが存在する場合、当該ファイルに格納された共有パスワードと利用者が入力したパスワードを照合し、一致した場合のみ発注会社モードで起動し、一致しない場合はエラー終了とする。発注会社専用設定ファイルが存在しない場合はベンダーモードで起動するものとし、コメントや起票者名などに記録されるユーザ名は、いずれのモードにおいても利用者が入力欄に都度手入力する方式とする（FR-004）。発注会社専用設定ファイルは初期化コマンド（FR-024）により生成できる。

発注会社とベンダー間のデータ同期やコンフリクト解消は、アプリケーション外部でgit等のツールによって行う運用とし、本システムはローカルまたは共有フォルダに存在するJSONファイル群のみを直接読み書きすることを責務とする（FR-005）。

本システムは、一覧表示や操作性に関する前提として、一ページあたりの課題表示件数のデフォルトを20件とし（FR-022）、想定される利用規模として各社10ユーザ程度かつ課題数およびコメント数は数百件規模を目安とした性能要件に適合することを前提とする（TR-012）。また、gitを用いたデータ同期運用として、発注会社側では朝会後および終礼後、ベンダー側では昼前および終礼後にデータを展開する運用ルールを想定し、これを前提とした設計とする（TR-013）。

## 2. 機能的要求

### 2.1 機能的要求一覧

| 要求ID   | 要求内容                                                                                                                                                                                                                                                                                         |
| ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FR-001 | 本システムは、発注会社とベンダーの間で共有される一つのプロジェクトに関する課題を管理し、特に課題ごとのコメントのやり取りをログとして視認しやすくすることを主な目的とする。                                                                                                                                                                                                            |
| FR-002 | 本システムは一度の起動につき一つのプロジェクトのみを対象とする。対象プロジェクトのデータフォルダは、起動時の設定ファイルまたは起動時の選択画面で指定する。起動時の選択画面で指定されたデータフォルダパスは設定ファイルに保存し、次回起動時の既定値として利用する。起動後に画面上で複数プロジェクトを切り替える機能は提供しない。 |
| FR-003 | 本システムは、発注会社とベンダーが同一プロジェクトの課題を共有して利用する前提とし、発注会社をマスタとして位置付け、課題のクローズおよび却下は発注会社のみが実行できるようにする。                                                                                                                                                                                                            |
| FR-004 | 本システムはユーザ管理や個々のユーザを対象とした認証機構を提供せず、アプリケーションは起動時に所定パスに配置された発注会社専用設定ファイルの有無により動作モードを判定する。発注会社専用設定ファイルが存在する場合には、その設定ファイルに格納された共有パスワードと利用者が入力したパスワードを照合し、一致した場合のみ発注会社モードで起動し、一致しない場合はエラー終了とする。発注会社専用設定ファイルが存在しない場合はベンダーモードで起動するものとし、コメントや起票者名などに記録されるユーザ名は、いずれのモードにおいても利用者が入力欄に都度手入力する方式とする。発注会社専用設定ファイルは初期化コマンド（FR-024）により生成できる。|
| FR-005 | 本システムは、発注会社とベンダー間のデータ同期やコンフリクト解消処理を内部には持たず、ローカルまたは共有フォルダ上のJSONファイル群のみを直接読み書きし、組織間の同期はgit等の外部ツールにより行う運用を前提とする。                                                                                                                                                                                    |
| FR-006 | 本システムのデータ構造は、一プロジェクトの配下に複数のカテゴリを持ち、カテゴリは現行のエクセルにおけるシートに相当する単位として扱い、利用者はカテゴリを選択した後にそのカテゴリに属する課題一覧および課題詳細を参照できるようにする。                                                                                                                                                                          |
| FR-007 | 本システムは、課題を新規登録、閲覧、更新、およびクローズや却下による終了として扱うことができるものとし、各課題は少なくとも課題識別子、カテゴリ名、タイトル、説明、ステータス、優先度、作成元会社、作成日時、更新日時、課題担当者名、および回答希望期限を保持する。                                                                                                                                                                   |
| FR-008 | 本システムは、課題の起草時または編集時に回答希望期限を入力できるようにし、回答希望期限は課題情報の一部として保存され、少なくとも課題一覧および課題詳細画面で参照できるものとする。                                                                                                                                                      |
| FR-009 | 本システムは、ステータスとして「新規」「対応中」「問い合わせ中」「保留」「差し戻し」「完了」「クローズ」「却下」の八種類を利用し、「新規」は起票直後の状態、「対応中」はいずれかの対応側が作業中の状態、「問い合わせ中」は発注会社またはベンダー以外の第三者に問い合わせている状態、「保留」は一時的に対応を停止している状態、「差し戻し」は対応側の完了内容に対して起草者側が再検討を求めている状態、「完了」は対応側の作業が完了し起草者の確認待ちの状態、「クローズ」は起草者も含め全員が対応完了に合意した終了状態、「却下」は全員が対応不要と判断した終了状態を意味するものとして定義する。 |
| FR-010 | 本システムは、ステータスを「新規」「対応中」「問い合わせ中」「保留」「差し戻し」「完了」をオープン状態、「クローズ」「却下」を終了状態として扱い、終了状態となった課題は再オープンせず、新たな課題が必要な場合は新規起票によって対応する運用とする。                                                                                                                                                                   |
| FR-011 | 発注会社モードでは、利用者は全てのステータス間で課題のステータスを変更できるものとし、オープン状態同士の遷移に加えて、任意のオープン状態から「完了」「クローズ」「却下」への変更が可能であり、終了状態からオープン状態への遷移は行わない。                                                                                                                                                                          |
| FR-012 | ベンダーモードでは、利用者は全てのオープン状態に属するステータスの間でステータスを変更できるものとする。                                                                                                                                  |
| FR-013 | ベンダーモードでは、利用者は課題のステータスを「クローズ」または「却下」に変更することはできず、終了状態となった課題のステータスを変更することもできないものとする。                                                                                                                                                                                                             |
| FR-014 | 発注会社モードでは、利用者は新規課題を起票することができ、その際作成元会社として発注会社が記録されるものとし、ベンダーモードでも新規課題を起票することができ、その際作成元会社としてベンダーが記録されるものとする。                                                                                                                                                                                           |
| FR-015 | 本システムは、課題に対するコメントを時系列で蓄積する機能を持ち、各コメントはコメント識別子、本文、投稿者名、投稿者の会社区分（発注会社またはベンダー）、および投稿日時を保持する。コメント本文はMarkdown記法を用いたテキストとして扱うことができ、コメント一件あたりの本文サイズは100KB以内とする。コメントはログとして追記のみ可能であり、登録後の編集や削除は発注会社・ベンダーいずれのモードからも行えないものとし、コメントの更新日時は投稿後に変更されないため投稿日時と同一とみなす。                                                 |
| FR-016 | 本システムは、発注会社モードおよびベンダーモードのいずれにおいても、閲覧可能な課題に対して新たなコメントを追加できるようにし、コメントの追記操作のみを許可し、コメントの編集および削除操作は提供しない。                                                                                                                                                                                             |
| FR-017 | 本システムは、カテゴリごとに課題の一覧を表示できるようにし、一覧には少なくとも課題のタイトル、現在のステータス、作成元会社、更新日時、および回答希望期限を表示し、ステータス、更新日時、回答希望期限を用いた簡易な絞り込みまたはソートを行えるものとする。                                                                                                                                                                |
| FR-018 | 本システムは、カテゴリ構造の追加および削除やプロジェクト配下のフォルダ構成の変更は発注会社モードのみで行えるようにし、ベンダーモードからはカテゴリ構造を変更する操作を行えないようにする。                                                                                                                                                                                                    |
| FR-019 | 本システムは、課題やコメントの操作履歴を追跡できるように、課題およびコメントに作成日時および更新日時を保持し、少なくとも画面上で最新の更新日時を確認できるようにする。コメントについては編集を行わないため、コメントの更新日時は作成時刻と同一とみなされる。                                                                                                                                                               |
| FR-020 | 本システムは、発注会社とベンダーのいずれのモードでも、同一プロジェクト内に存在する全ての課題を閲覧対象とし、会社による課題の可視範囲の違いを設けないものとする。                                                                                                                                                                                                                 |
| FR-021 | 本システムは、各コメントに対して添付ファイルを関連付ける機能を提供し、一つのコメントに対して複数の添付ファイルを登録できるようにする。添付ファイルは課題詳細画面から参照・保存できるものとし、添付ファイルの存在および数はコメントの表示と合わせて利用者が把握できるようにする。                                                                                                                                                     |
| FR-022 | 本システムは、カテゴリごとの課題一覧表示において、一ページあたりの表示件数のデフォルト値を20件とし、20件を超える課題が存在する場合はページングにより一覧を分割表示する。                                                                                                                                                                                                       |
| FR-023 | 本システムは、発注会社とベンダーによる運用として、git等を用いたデータ同期のタイミングを発注会社側では朝会後および終礼後、ベンダー側では昼前および終礼後とすることを前提とした設計とし、この前提のもとで前述の性能および整合性要求を満たすものとする。                                                                                                                                                                         |
| FR-024 | 本システムは、発注会社専用設定ファイル（auth/contractor.json）を生成する初期化コマンドを提供する。利用者が `ratta.exe init contractor` を実行した場合、共有パスワードの入力（確認入力を含む）を受け付け、暗号化済みの情報として設定ファイルに保存する。既に設定ファイルが存在する場合は、明示的な上書きオプション（例: `--force`）が指定されない限り上書きせず、エラー終了する。 |
## 3. 技術的要求

### 3.1 技術的要求一覧

| 要求ID   | 要求内容                                                                                                                                                                                                              |
| ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| TR-001 | 本システムは、ElectronやWails等のWeb技術を用いたデスクトップアプリケーションとして実装し、利用者ごとのWindows PC上でローカルアプリケーションとして動作し、サーバ常駐型のWebアプリケーションやブラウザベースのシステムを前提としない。                                                                                 |
| TR-002 | 本システムは、課題データを永続化するために、各課題を一つのJSONファイルとして保存する方式を採用し、一課題一ファイルの構成をとる。                                                                                                                                                |
| TR-003 | 本システムは、プロジェクトのデータルートフォルダの直下にカテゴリごとのサブフォルダを配置し、各カテゴリサブフォルダの配下に個々の課題JSONファイルを格納するディレクトリ構造とする。データルートフォルダのパスは起動時に設定ファイルまたは選択画面により指定される。選択画面で指定された場合、設定ファイルに当該パスを保存する。 |
| TR-004 | 本システムが扱う課題JSONファイルは、課題識別子、カテゴリ名、タイトル、説明、ステータス、優先度、作成元会社、作成日時、更新日時、回答希望期限、およびコメント配列など、合意されたJSONスキーマに従うものとし、スキーマは将来的な拡張を前提にしつつも現段階では固定のものとして扱う。                                                                     |
| TR-005 | 本システムは、課題JSONファイルの更新時に直接上書きを行わず、一時ファイルに対して書き込みを行った後、ファイルシステムのリネーム操作により本来のファイル名へ置き換える方法を採用し、書き込み途中の異常終了によるファイル破損のリスクを低減する。                                                                                         |
| TR-006 | 本システムは、課題ファイルの編集に関してアプリケーション内のロック機構を実装せず、複数端末からの更新が競合した場合の解決はgit等の外部バージョン管理ツールによるマージ処理に委ねる設計とし、アプリケーション側ではJSONファイルの正しい読み書きのみを責務とする。                                                                               |
| TR-007 | 本システムは、起動時に所定パスに配置された発注会社専用設定ファイルの有無および当該ファイルに格納された共有パスワード情報との照合結果に基づき、発注会社モードまたはベンダーモードを判定する。発注会社専用設定ファイルの生成は初期化コマンド（FR-024）により行う。モードに応じてUI表示やステータス変更等の制御を行い、FR-011からFR-018で定義された権限制御を実現する。 |
| TR-008 | 本システムが保存するJSONファイルは文字コードとしてUTF-8を使用し、日時表現にはタイムゾーン情報を含むISO 8601形式を用いることで、発注会社およびベンダー間でのデータ交換やgitによる差分閲覧時に混乱が生じないようにする。                                                                                                 |
| TR-009 | 本システムは、インターネットに接続されていないオンプレミス環境においても単独で動作可能であり、外部クラウドサービスや外部APIへの依存を持たない構成とし、発注会社およびベンダーのWindowsデスクトップ環境上での運用を前提とする。                                                                                                  |
| TR-010 | 本システムは、課題データのバックアップおよびリストア機能を内蔵せず、課題JSONファイル群の保全はファイルサーバやローカルストレージに対する既存のバックアップ運用に委ねる設計とし、アプリケーションの責務範囲をデータの作成と更新に限定する。                                                                                           |
| TR-011 | 本システムは、コメントに添付される添付ファイルをファイルシステム上に別ファイルとして保存し、各課題JSONファイルと同じカテゴリフォルダ配下に、課題識別子を名称に含むサブフォルダ（例：`<issue_id>.files`）を作成してその中に格納する構成とする。コメントデータには、当該課題内の添付ファイルを識別するための相対パスまたはファイル名を保持するものとし、添付ファイルの配置場所表現にゆれが生じないようにする。 |
| TR-012 | 本システムは、各社10ユーザ程度、総課題数およびコメント数がそれぞれ数百件規模であることを想定した性能要件を満たすものとし、この規模においてカテゴリごとの課題一覧表示（一ページ20件）や課題詳細表示が実用上支障のない応答時間で行えるように設計される。                                                                                     |
| TR-013 | 本システムは、発注会社およびベンダーによるgit等を用いたデータ同期運用として、発注会社側では朝会後および終礼後、ベンダー側では昼前および終礼後にデータを展開することを想定し、この同期タイミングを前提とした上でgitマージや競合解消によりデータ整合性が維持される構成とする。                                                                                 |

以上の機能的要求および技術的要求を本システムの要求仕様とし、後続の要件定義および設計工程において各要求IDとのトレーサビリティを維持するものとする。
