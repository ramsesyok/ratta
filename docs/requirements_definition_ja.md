# 要件定義書（課題管理デスクトップアプリケーション）

## 1. 文書の目的

本書は、「要求仕様書」で定義された機能的要求（FR-xxx）および技術的要求（TR-xxx）を実現するために、本システムの具体的な要件を明文化するものである。
各要件には要件IDを付与し、対応する要求IDを記載することで、要求仕様とのトレーサビリティを確保する。

---

## 2. システム概要・前提要件

### SY-001 システムの目的と対象範囲

要件ID: SY-001
対応要求ID: FR-001, FR-020

本システムは、発注会社とベンダーの間で共有される一つのプロジェクトに関する課題を管理するデスクトップアプリケーションとする。現行のファイル分割運用を置き換え、特に課題ごとのコメントのやり取りをログとして視認しやすく残すことを主要な目的とする。また、発注会社モード・ベンダーモードのいずれであっても、同一プロジェクトに存在する全ての課題を両社が閲覧できるものとし、会社による可視範囲の違いは設けない。

### SY-002 発注会社モード・ベンダーモードとユーザ名の扱い

要件ID: SY-002
対応要求ID: FR-003, FR-004, TR-007

本システムは、起動時に会社モードを判定し、発注会社モードまたはベンダーモードのいずれかとして動作する。会社モードは、所定の場所に配置された発注会社専用の設定ファイルの有無およびその内容によって決定される。発注会社専用設定ファイルが存在する場合、起動時に当該ファイルに記載されたパスワードと利用者の入力値を照合し、一致した場合にのみ発注会社モードとして起動する。一致しない場合は発注会社モードでは起動せず、起動エラーとして扱う。発注会社専用設定ファイルが存在しない場合はベンダーモードとして起動する。
本システムはユーザ管理機能やログイン機能を持たず、コメントや起票者名に記録されるユーザ名は利用者が任意の文字列を手入力する方式とし、ユーザ名の形式や一意性をアプリケーションとしては制約しない。

### SY-003 データ同期と責務分界

要件ID: SY-003
対応要求ID: FR-005, TR-006, TR-009, TR-010

本システムは、課題データの同期やコンフリクト解消を内部機能としては持たず、ローカルまたは共有フォルダ上のJSONファイル群のみを直接読み書きする。発注会社とベンダー間のデータ同期およびマージ処理は、gitなどのバージョン管理ツールを用いて運用側で実施することを前提とする。
課題データのバックアップおよびリストアは、既存のファイルシステムおよびバックアップ運用に委ね、本システムは課題JSONファイルの作成および更新のみを責務とする。インターネット非接続のオンプレミス環境において単独で動作し、外部クラウドサービスや外部APIには依存しない構成とする。

---

## 3. 機能要件

### 3.1 プロジェクト・モード関連

#### F-001 プロジェクト単位と起動単位

要件ID: F-001
対応要求ID: FR-002

本システムは、一度のアプリケーション起動につき一つのプロジェクトのみを対象とする。対象プロジェクトのデータルートフォルダのパスは設定ファイルまたは起動時の選択画面によって指定する。起動時の選択画面で指定されたパスは設定ファイルに保存し、次回起動時の既定値として利用する。起動後に画面操作によりプロジェクトを切り替える機能は提供しない。同一PC上で複数のプロセスとして本アプリケーションを同時に起動し、それぞれが別のプロジェクトのデータルートフォルダを扱うことは許容される。

#### F-002 発注会社モード・ベンダーモードの決定方法

要件ID: F-002
対応要求ID: FR-004, TR-007

本システムは、起動時に所定のパスに発注会社専用の設定ファイルが存在するかどうかを確認し、存在する場合は発注会社モード候補として処理を行う。発注会社専用設定ファイルが存在する場合、利用者からパスワードの入力を受け付け、その値が設定ファイル内の値と一致した場合に発注会社モードとして起動する。一致しない場合は発注会社モードとして起動せず、アプリケーションはエラーを表示して終了する。発注会社専用設定ファイルが存在しない場合は、ベンダーモードとして起動する。これにより、本来発注会社モードで動作させるべき端末で誤ってベンダーモードとして利用されることを防止する。

#### F-003 課題の起票と作成元会社の記録

要件ID: F-003
対応要求ID: FR-014, FR-020

本システムは、発注会社モードおよびベンダーモードのいずれにおいても新規課題を起票できるようにする。新規課題を登録する際、課題情報には作成元会社を示すフィールドを保持し、発注会社モードで起票した課題には発注会社、ベンダーモードで起票した課題にはベンダーを記録する。いずれの会社が起票した課題であっても、同一プロジェクト内の全課題は発注会社・ベンダーの双方から閲覧可能とする。

#### F-004 ステータス変更における発注会社・ベンダーの権限

要件ID: F-004
対応要求ID: FR-003, FR-011, FR-012, FR-013

本システムは、課題のステータス変更に関して、発注会社モードとベンダーモードで異なる操作権限を適用する。発注会社モードでは、オープン状態に属する全てのステータス間で課題ステータスを変更できるものとし、加えて任意のオープン状態から「完了」「クローズ」「却下」のいずれかの終了状態へ直接変更することを許可する。一方で、終了状態となった課題については、いかなるステータスからもオープン状態へ戻すことはできない。
ベンダーモードでは、ステータスとして「新規」「対応中」「問い合わせ中」「保留」「差し戻し」「完了」の範囲で、オープン状態同士の変更を行うことができる。ただし、課題のステータスを「クローズ」または「却下」に変更することはできず、終了状態となった課題のステータスを変更することもできない。

#### F-005 発注会社専用設定ファイルの初期化コマンド

要件ID: F-005
対応要求ID: FR-024

本システムは、発注会社専用設定ファイル（auth/contractor.json）を生成する初期化コマンドを提供する。初期化コマンドはGUIを起動せずに実行でき、共有パスワードの入力（確認入力を含む）を受け付ける。共有パスワードは平文で保存せず、暗号化等の方式により保護された形で設定ファイルへ保存する。生成済みの設定ファイルが存在する場合、明示的な上書き指定がない限り上書きせずにエラー終了する。生成に成功した場合、auth フォルダを作成し、配下に設定ファイルを保存して終了する。


### 3.2 課題情報とステータス管理

#### F-101 課題情報の構成とステータス種別

要件ID: F-101
対応要求ID: FR-007, FR-009, FR-010

本システムが扱う課題は、少なくとも課題識別子、カテゴリ名、タイトル、説明、ステータス、優先度、作成元会社、作成日時、更新日時、回答希望期限を保持する。ステータスは「新規」「対応中」「問い合わせ中」「保留」「差し戻し」「完了」「クローズ」「却下」の八種類とし、各ステータスの意味を次のように定義する。
新規は起草直後で未対応の状態、対応中は対応作業が進行中の状態、問い合わせ中は第三者等への問い合わせにより回答待ちの状態、保留は何らかの理由で対応を中断している状態、差し戻しは対応側の完了内容に対して起草者側が再検討を求めている状態、完了は対応側の作業が完了し起草者側の確認待ちの状態、クローズは起草者を含めた関係者が対応完了に合意した終了状態、却下は全員が対応不要と判断した終了状態とする。
「新規」「対応中」「問い合わせ中」「保留」「差し戻し」「完了」をオープン状態、「クローズ」「却下」を終了状態とし、終了状態となった課題は再オープンを行わず、再度対応が必要な場合は新たな課題を起票する運用とする。

#### F-102 回答希望期限の扱い

要件ID: F-102
対応要求ID: FR-007, FR-008, FR-017

本システムは、課題の起草時または編集時に回答希望期限を入力できるようにし、回答希望期限を課題情報として保存する。回答希望期限は、課題一覧画面および課題詳細画面で日付情報として表示され、課題一覧では回答希望期限によるソートおよび簡易な絞り込みに利用できるものとする。複数条件を組み合わせた高度な検索条件（例として「オープン状態かつ期限切れ」など）は将来拡張とし、現時点の要件には含めない。

#### F-103 課題の作成日時・更新日時の管理

要件ID: F-103
対応要求ID: FR-019

本システムは、全ての課題について作成日時および更新日時を管理する。作成日時は課題が初めて保存された時点の日時を記録し、更新日時は課題情報（ステータス、説明、回答希望期限など）に変更が発生した時点の最新日時を記録する。課題一覧画面および課題詳細画面では、少なくとも更新日時を表示し、利用者が課題の最新の変更時刻を把握できるようにする。

### 3.3 コメントおよび添付ファイル

#### F-201 コメントの構造と編集ポリシー

要件ID: F-201
対応要求ID: FR-015, FR-016, FR-019

本システムは、各課題に対してコメントを時系列に蓄積する機能を提供する。各コメントは、コメント識別子、本文、投稿者の会社区分、投稿者名、投稿日時、および必要に応じて更新日時（将来拡張を含む）を保持する。コメント本文はMarkdown形式で保存・表示し、改行やソースコード断片などを含む長文を扱えるようにする。1件あたりのコメントの最大サイズは約100KBを上限とし、通常の利用では数十KB程度で十分な情報を記述できることを想定する。
コメントはログとしての性質を重視し、登録後の編集および削除をアプリケーション機能としては提供しない。明らかな誤投稿や機密情報の誤記載などでコメントを物理的に削除する必要が生じた場合は、gitやテキストエディタを用いてアプリケーション外で修正する運用とする。発注会社モードおよびベンダーモードのいずれにおいても、閲覧可能な課題に対して新たなコメントを追記することができる。

#### F-202 コメントの表示順とタイムスタンプ表示形式

要件ID: F-202
対応要求ID: FR-015, FR-016, FR-019

本システムは、課題に紐付くコメントを古い順に表示し、新しいコメントが既存の一覧の下部に追加される表示形式とする。コメントの投稿日時は、日本語表記の日時形式で表示し、そのフォーマットを「YYYY年MM月DD日 hh時mm分ss秒」とする。これにより、発注会社およびベンダーの利用者がコメントの時系列を直感的に把握できるようにする。

#### F-203 コメントへの添付ファイル

要件ID: F-203
対応要求ID: FR-021, TR-011, FR-015

本システムは、コメントに対して添付ファイルを紐付ける機能を提供する。添付可能なファイル種別は画像ファイルおよびテキストファイル（ソースコードファイルを含む）とし、それ以外のファイル種別は必須要件とはしない。各コメントには複数の添付ファイルを紐付けられるものとし、課題詳細画面ではコメント本文と併せて各添付ファイルへのリンクまたはサムネイルを表示する。添付ファイルの実体はプロジェクト配下の所定ディレクトリに保存し、コメント側には添付ファイルを一意に識別可能な情報（ファイル名や相対パスなど）を保持する。

### 3.4 画面機能

#### UI-000 起動時プロジェクト選択

要件ID: UI-000
対応要求ID: FR-002

本システムは、起動時に対象プロジェクトのデータルートフォルダを選択するための画面（ダイアログ）を提供できる。ダイアログには設定ファイルに保存された前回のデータルートフォルダパスを既定値として表示する。利用者は、既定値のまま開く、別フォルダを参照して開く、または新規にプロジェクトフォルダを作成して開く、のいずれかを選択できる。対象フォルダを確定して開いた場合、本システムは確定したデータルートフォルダパスを設定ファイルに保存する。利用者がキャンセルした場合、本システムは起動を中止して終了する。指定フォルダが存在しない、またはアクセスできない場合はエラーを表示し、再選択できる。

#### UI-001 カテゴリ単位の課題一覧表示

要件ID: UI-001
対応要求ID: FR-006, FR-017, FR-020

本システムは、プロジェクト配下のカテゴリごとに課題一覧を表示する画面を提供する。利用者はまずカテゴリを選択し、そのカテゴリに属する全ての課題について一覧を閲覧できる。発注会社モードおよびベンダーモードのどちらにおいても、同一プロジェクト内のカテゴリおよび課題は全て閲覧対象とし、会社モードによる表示対象の制限は行わない。

#### UI-002 課題一覧に表示する項目

要件ID: UI-002
対応要求ID: FR-007, FR-017

本システムの課題一覧画面では、各課題について少なくとも次の項目を表示する。課題タイトル、ステータス、優先度、作成元会社、更新日時、および回答希望期限である。必要に応じて課題識別子も表示し、ユーザが課題を一意に識別できるようにする。これらの項目は、後続の並び替えや絞り込み機能で利用される。

#### UI-003 課題一覧のソートおよびフィルタ

要件ID: UI-003
対応要求ID: FR-017, FR-022

本システムは、課題一覧に対してステータス、更新日時、回答希望期限、および優先度を用いたソートおよび簡易なフィルタ機能を提供する。例えば、優先度の高い順に並び替えたり、特定のステータスのみを表示したりする操作が行えるようにする。一方で、「オープン状態かつ回答期限切れ」など、複数条件を組み合わせた高度な検索条件は今回の要件には含めない。1ページあたりに表示する課題件数は20件をデフォルトとし、一覧はページング方式で切り替えられるようにする。

#### UI-004 終了状態課題の表示方法

要件ID: UI-004
対応要求ID: FR-010

本システムは、「クローズ」および「却下」の終了状態にある課題を、課題一覧上でグレーアウト表示する。これにより、利用者は一覧画面においてオープン状態の課題と終了状態の課題を視覚的に区別できる。終了状態の課題も閲覧対象には含めるが、終了状態からオープン状態へのステータス変更ができないことが一覧上の表示からも推測しやすいようにする。

#### UI-005 課題詳細画面と編集モード

要件ID: UI-005
対応要求ID: FR-007, FR-008, FR-009, FR-015, FR-016

本システムは、課題の詳細情報および紐付くコメントを表示する課題詳細画面を提供する。課題詳細画面の初期状態は閲覧モードとし、利用者は「編集」ボタンを明示的に選択することで編集モードへ切り替える。編集モードでは、課題タイトル、説明、回答希望期限、優先度、ステータスなど、発注会社モードまたはベンダーモードで許可されている範囲の項目を更新できる。
課題のタイトル、説明、回答希望期限、優先度は必須入力項目とし、これらの項目のラベルには赤い「＊」のマークを付与して必須であることを明示する。カテゴリについてはフォルダ構成によって決定されるため、画面上では自動的に設定された値を表示するのみとし、通常操作では変更不可とする。ステータス変更とコメント追加は別の操作体系とし、ステータス変更は課題情報の更新操作、コメント追加はコメント追記専用の操作として区別して扱う。

#### UI-006 コメント追加操作

要件ID: UI-006
対応要求ID: FR-015, FR-016

本システムは、閲覧可能な全ての課題に対してコメント追加ボタンを提供する。利用者がコメント追加ボタンを押下すると、Markdown形式で本文を入力できるエリアおよび投稿者名入力欄、必要に応じて添付ファイルの選択欄が表示される。コメントを送信すると、コメントは既存のコメント一覧の末尾に追加される。登録済みのコメントに対する編集および削除ボタンは提供せず、コメントは常に追記専用とする。

### 3.5 カテゴリ管理

#### F-301 カテゴリ構造の管理権限

要件ID: F-301
対応要求ID: FR-006, FR-018, TR-003

本システムは、プロジェクト配下のカテゴリ構造（カテゴリの追加、削除、名称変更）について、発注会社モードでのみ変更操作を行えるようにする。発注会社モードにおいてカテゴリを追加した場合は、プロジェクトのデータルートフォルダ直下に新たなカテゴリサブフォルダを作成し、カテゴリを削除する場合は当該カテゴリに属する課題ファイルが存在しないことを前提とするか、別のカテゴリへの移動を行ったうえで削除する運用とする。カテゴリ名とカテゴリサブフォルダ名は、管理の容易さから原則として同一の名称を用いる。
ベンダーモードではカテゴリ構造の参照のみを許可し、カテゴリの追加・削除・名称変更の操作は行えないようにする。

---

## 4. データ要件

#### D-001 ディレクトリ構成とファイル配置

要件ID: D-001
対応要求ID: TR-001, TR-002, TR-003, FR-006

本システムが扱うプロジェクトデータは、データルートフォルダ配下にカテゴリごとのサブフォルダを持つディレクトリ構成とする。1つの課題は1つのJSONファイルとして保存し、一課題一ファイルの構成をとる。また、課題に添付されたファイルは、`<issue_id>.files` 等のサブフォルダに格納する。プロジェクトのデータルートフォルダのパスは設定ファイルまたは起動時の選択画面により指定され、アプリケーション起動時に確定する。起動時の選択画面で確定したパスは設定ファイルに保存される。

#### D-002 課題JSONファイル名と課題識別子

要件ID: D-002
対応要求ID: TR-002, TR-004, FR-007

本システムは、課題JSONファイルのファイル名として課題識別子に拡張子「.json」を付与した形式を用いる。例えば、課題識別子が「abc123456」の場合、対応するファイル名は「abc123456.json」とする。課題識別子はプロジェクト内で一意となるように管理し、その具体的な採番方式（連番、日付＋連番など）は設計段階で定義する。アプリケーションは課題識別子とファイル名の対応を前提として動作し、課題一覧や詳細表示では課題識別子から対応するJSONファイルを特定して読み込む。

#### D-003 JSONスキーマと共通フィールド

要件ID: D-003
対応要求ID: TR-004, FR-007, FR-015, FR-019

本システムが扱う課題JSONファイルは、共通のJSONスキーマに従う。スキーマには少なくとも以下のフィールドを含める。課題識別子、カテゴリ名、タイトル、説明、ステータス、優先度、作成元会社、作成日時、更新日時、回答希望期限、コメント配列、課題担当者名、添付ファイル参照情報、およびスキーマバージョンを示す「version」フィールドとする。コメント配列の各要素には、コメント識別子、本文、投稿者の会社区分、投稿者名、投稿日時、および添付ファイル参照情報を含める。
「version」フィールドは将来のスキーマ拡張や移行に備えるための内部管理用とし、通常の画面表示には用いない。スキーマは現段階では固定とし、後続の設計工程で詳細なフィールド構成とデータ型を定義する。

#### D-004 文字コードと日時の保存形式

要件ID: D-004
対応要求ID: TR-008, FR-019

本システムが保存する全てのJSONファイルは、文字コードとしてUTF-8を用いる。日時を表すフィールド（作成日時、更新日時、コメント投稿日時など）は、タイムゾーン情報を含むISO 8601形式で保存し、例として「2025-12-06T10:30:00+09:00」のような表記とする。内部的には秒までの精度で管理し、ミリ秒以下は取り扱わない。画面上では、日本語表記の形式（「YYYY年MM月DD日 hh時mm分ss秒」）に変換して表示する。

#### D-005 JSONファイルの整形ルール

要件ID: D-005
対応要求ID: TR-004

本システムは、課題JSONファイルを書き出す際にインデント幅2スペースの整形ルールを適用し、キーの並び順も固定する。これにより、gitなどのバージョン管理ツールで差分を閲覧する際に不要な差分が発生しないようにする。キーの並び順は後続の設計で定義し、アプリケーションは常に同一の順序でJSONを出力する。

#### D-006 破損ファイルおよびスキーマ不整合ファイルの扱い

要件ID: D-006
対応要求ID: TR-004, TR-006

本システムは、課題一覧を読み込む際に各課題JSONファイルをパースし、JSONとして解釈できないファイルや必須フィールドが欠落しているファイルを検知する。JSONパースに失敗したファイルについては、課題一覧から完全に除外するのではなく、少なくともファイル名とエラーメッセージを一覧画面または専用のエラー表示領域に表示する。これにより、利用者が手動で復旧作業を行えるようにする。
スキーマに合致しないが一部フィールドは読み取れるファイルについては、表示可能な項目を可能な範囲で表示しつつ、アイコンやメッセージなどでスキーマ不整合があることを明示する。

---

## 5. 技術要件

#### T-001 採用技術とアプリケーション形態

要件ID: T-001
対応要求ID: TR-001, TR-009

本システムは、Wailsを用いたデスクトップアプリケーションとして実装し、そのフロントエンド部分にはVue 3およびVuetify 3を採用する。アプリケーションは各利用者のPC上でローカルアプリケーションとして動作し、サーバ常駐型のWebアプリケーションやブラウザベースのシステムを前提としない。また、インターネット非接続のオンプレミス環境で動作可能であり、外部クラウドサービスや外部APIに依存しない構成とする。

#### T-002 対応OSとアーキテクチャ

要件ID: T-002
対応要求ID: TR-001, TR-009

本システムの公式なサポート対象OSはWindowsとし、Windows 10以降の64bit環境を対象とする。Wailsが利用するWebViewが標準的に利用可能なバージョンを前提とする。Linux環境での動作は必須要件とはせず、今回の要件定義の対象外とする。32bit OSはサポート対象外とし、インストールおよび動作保証は行わない。

#### T-003 アプリケーションの配布形態

要件ID: T-003
対応要求ID: TR-001

本システムは、インストーラ形式ではなくzipアーカイブとして配布する。利用者は配布されたzipファイルを任意のフォルダに展開し、展開先フォルダ内の実行ファイルを起動して利用する。バージョンアップ時は、原則としてアプリケーション本体および設定ファイルの差し替えのみで対応できるように設計し、データスキーマのマイグレーション作業が不要となる後方互換性を考慮する。

#### T-004 JSONファイル更新時の安全な書き込み

要件ID: T-004
対応要求ID: TR-005

本システムは、課題JSONファイルを更新する際に、直接既存ファイルを上書きせず、一時ファイルに対して全内容を書き込んだ後、ファイルシステムのリネーム操作により本来のファイル名へ置き換える方式を採用する。この方式により、書き込み途中でアプリケーションが異常終了した場合でも、既存の課題ファイルが破損するリスクを低減する。

#### T-005 ロック機構とGit運用との関係

要件ID: T-005
対応要求ID: TR-006

本システムは、課題ファイルに対するアプリケーション内の排他ロック機構を持たない。複数端末から同一課題に対して更新が行われた場合の競合は、git等のバージョン管理ツールによるマージ処理に委ねる。アプリケーションはJSONファイルの正しい読み書きおよび破損やスキーマ不整合の検出を責務とし、マージ結果として不整合なJSONが生成された場合にはD-006で定義したエラー表示により利用者に通知する。

#### T-006 ログ出力

要件ID: T-006
対応要求ID: なし（要件定義段階で追加された補足要件）

本システムは、アプリケーション内部のエラーログをファイルとして出力する。ログ出力先はアプリケーションフォルダ配下とし、ログファイルのサイズまたは世代数に基づくローテーション機能を実装する。通常の操作ログやアクセスログは必須要件とはせず、エラー解析に必要な範囲の情報のみを記録する。

---

## 6. 非機能要件・運用要件

#### NF-001 想定利用規模

要件ID: NF-001
対応要求ID: FR-002, FR-005, TR-009, TR-012

本システムの利用者数は、発注会社およびベンダーそれぞれで10人以下を想定する。同一プロジェクトに対する同時利用も10ユーザ程度までを前提とし、この利用規模において課題一覧の表示や課題詳細の表示・更新が実用的な応答時間で行える性能を確保する。課題数やコメント数については数百件規模を想定し、極端に大規模なプロジェクト管理はスコープ外とする。

#### NF-002 発注会社・ベンダー間のGit同期運用

要件ID: NF-002
対応要求ID: FR-005, FR-023, TR-006, TR-010, TR-013

本システムにおける発注会社とベンダー間のデータ同期は、git等の外部ツールを用いて運用側で行う。運用上の前提として、発注会社は朝会後および終礼後のタイミングでリポジトリをベンダー向けに展開し、ベンダーは昼前後および終礼後のタイミングで発注会社にリポジトリを送付する運用とする。これらの同期タイミングにより、日中の作業内容が双方に反映されることを前提として、アプリケーション側のリアルタイム同期機能は要求しない。

---

以上が、現時点で確定している本システムの要件定義である。
今後の詳細設計工程では、本書に記載した要件IDと要求仕様書のFR/TR IDとの対応関係を維持しつつ、画面レイアウト、JSONスキーマ定義、採番方式などの具体的な設計を行う。
